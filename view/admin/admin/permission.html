<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <link rel="stylesheet" href="__ADMIN__/css/pearCommon.css" />
    <link rel="stylesheet" href="__ADMIN__/layui/css/layui.css" />
    <style>
    /*分配权限*/
    .cate-box{margin-bottom: 15px;padding-bottom:10px;border-bottom: 1px solid #f0f0f0}
    .cate-box dt{margin-bottom: 10px;}
    .cate-box dt .cate-first{padding:10px 20px}
    .cate-box dd{padding:0 50px}
    .cate-box dd .cate-second{margin-bottom: 10px}
    .cate-box dd .cate-third{padding:0 40px;margin-bottom: 10px}
    </style>
</head>
<body>
    <form class="layui-form" action="">
        <div class="mainBox">
            <div class="main-container">
                <div class="layui-form-item">
                    <label for="" class="layui-form-label">用户名</label>
                    <div class="layui-word-aux layui-form-mid">{$admin->username}</div>
                </div>
                <div class="layui-form-item">
                    <label for="" class="layui-form-label">昵称</label>
                    <div class="layui-word-aux layui-form-mid">{$admin->nickname}</div>
                </div>
                <div class="layui-form-item">
                    <label for="" class="layui-form-label">权限</label>
                    <div class="layui-input-block">
                        {foreach $permissions as $p1}
                        <dl class="cate-box">
                            <dt>
                                <div class="cate-first"><input id="menu{$p1['id']}" type="checkbox" name="permissions[]" value="{$p1['id']}" title="{$p1['title']}" lay-skin="primary" {if isset($p1['own']) && $p1['own'] } checked {/if} ></div>
                            </dt>
                            {if isset($p1['children']) && !empty($p1['children']) }
                            {foreach $p1['children'] as $p2 }
                            <dd>
                                <div class="cate-second"><input id="menu{$p1['id']}-{$p2['id']}" type="checkbox" name="permissions[]" value="{$p2['id']}" title="{$p2['title']}" lay-skin="primary" {if isset($p2['own']) && $p2['own'] } checked {/if} ></div>
                                {if isset($p2['children']) && !empty($p2['children']) }
                                <div class="cate-third">
                                    {foreach $p2['children'] as $p3 }
                                    <input type="checkbox" id="menu{$p1['id']}-{$p2['id']}-{$p3['id']}" name="permissions[]" value="{$p3['id']}" title="{$p3['title']}" lay-skin="primary" {if isset($p3['own']) && $p3['own'] } checked {/if} >
                                    {/foreach}
                                </div>
                                {/if}
                            </dd>
                            {/foreach}
                            {/if}
                        </dl>
                        {/foreach}
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <button type="submit" class="layui-btn layui-btn-normal layui-btn-sm" lay-submit="" lay-filter="save">提 交</button>
                    </div>
                </div>
            </div>
        </div>
    </form>
<script src="__ADMIN__/layui/layui.js"></script>
<script>
    layui.use(['jquery','form','layer','closeTools'],function () {
         var $=layui.jquery;
         var form=layui.form;
         var layer=layui.layer;
         var closeTools = layui.closeTools;
 
         form.on('submit(save)',function (data) {
             var load = layer.load();
             $.post('/admin/permission/'+{$admin['id']},data.field,function (res) {
                 layer.close(load);
                 if (res.code==1){
                     layer.msg(res.msg,{icon:1,time:1500},function () {
                     })
                 } else {
                     layer.msg(res.msg,{icon:2,time:1500})
                 }
             });
             return false
         })

         form.on('checkbox', function (data) {
            var check = data.elem.checked;//是否选中
            var checkId = data.elem.id;//当前操作的选项框
            if (check) {
                //选中
                var ids = checkId.split("-");
                if (ids.length == 3) {
                    //第三极菜单
                    //第三极菜单选中,则他的上级选中
                    $("#" + (ids[0] + '-' + ids[1])).prop("checked", true);
                    $("#" + (ids[0])).prop("checked", true);
                } else if (ids.length == 2) {
                    //第二季菜单
                    $("#" + (ids[0])).prop("checked", true);
                    $("input[id*=" + ids[0] + '-' + ids[1] + "]").each(function (i, ele) {
                        $(ele).prop("checked", true);
                    });
                } else {
                    //第一季菜单不需要做处理
                    $("input[id*=" + ids[0] + "-]").each(function (i, ele) {
                        $(ele).prop("checked", true);
                    });
                }
            } else {
                //取消选中
                var ids = checkId.split("-");
                if (ids.length == 2) {
                    //第二极菜单
                    $("input[id*=" + ids[0] + '-' + ids[1] + "]").each(function (i, ele) {
                        $(ele).prop("checked", false);
                    });
                } else if (ids.length == 1) {
                    $("input[id*=" + ids[0] + "-]").each(function (i, ele) {
                        $(ele).prop("checked", false);
                    });
                }
            }
            form.render();
        });
 
     })
 </script>
</body>
</html>